# SPEC: cospec

## 1. プロジェクト概要
- **名前**: `cospec`
- **目的**: 人間とAIエージェントが協働し、高品質なソフトウェア開発（要件定義〜テスト〜レビュー）を推進するためのCLIプラットフォーム。
- **コアコンセプト**:
    1. **Codebase as Context**: ドキュメントをAIへの正解データとする。
    2. **Consistency First**: 実装前にドキュメントとコードの不整合を排除する。
    3. **Decision Support**: 選択肢とトレードオフを提示して人間の意思決定を支える。

## 2. 機能要件 (Functional Requirements)

### FR-001: プロジェクト初期化 (`init`)
- **機能**: 現在のディレクトリに `cospec` 推奨の構造（`docs/`, `Taskfile.yml`）を展開する。
- **ガイドライン注入**: `GuidlineDesign.md` 等の「思想」ファイルを自動配置する。

### FR-002: 要件ヒアリング (`hear`)
- **機能**: AIエージェントへの指令書（Mission Prompt）を生成する。
- **ワークフロー**:
    1. `cospec hear` がプロンプトを出力する。
    2. AIエージェント（Gemini, Claude等）がそのプロンプトを読み込む（AI自身が実行すればコピペ不要）。
    3. AIエージェントが主体となって `SPEC.md` を読み、選択肢（Pros/Cons）を提示してユーザーと合意形成し、ファイルを直接更新する。

### FR-003: テスト生成 (`test-gen`)
- **機能**: `SPEC.md` の要件からテストケースを抽出し、テストコード（Red）を生成する。
- **出力**: テストファイル (`tests/test_xxx.py`)。

### FR-004: 整合性レビュー (`review`)
- **機能**: プロジェクト全体を分析し、不整合や不足を指摘するレポートを出力する。
- **分析対象**:
    - `README{.ja}.md`
    - `docs/SPEC.md`, `docs/BLUEPRINT.md`
    - 実装コード (`src/`, `lib/` 等)
    - テストコード (`tests/`)
- **チェック観点**:
    - **不足**: SPECにあるが実装/テストがない、逆に実装にあるがSPECにない機能。
    - **不整合**: READMEの説明と実際の挙動の違い。
    - **ガイドライン準拠**: `Guidline{Design,CodingTesting}Thinking.md` のルール（型ヒント、モック利用など）を守っているか。
- **出力アーティファクト**:
    - ファイル名: `docs/review_{yyyyMMdd}_{AgentName}+{ModelName}.md`
    - 内容: 重要度別の警告、修正アドバイス。

### FR-005: 状況確認 (`status`)
- **機能**: 現在のフェーズ（Spec未定/Test失敗/Impl完了）を表示し、次のアクションを提案する。

## 3. 非機能要件
- **AIエージェント認証の分離**: APIキー管理は各AIエージェント（CLIツール）に委譲し、`cospec` 側では保持しない。ユーザーは利用可能な（認証済みの）エージェントを `cospec agent add` で登録する。
- **トークン効率**: コンテキストウィンドウを圧迫しないよう、関連ファイルのみを読み込む仕組み（RAG的アプローチ検討）。